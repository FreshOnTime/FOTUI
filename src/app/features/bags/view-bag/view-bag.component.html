<section class="bg-white py-6 antialiased dark:bg-gray-900">
  <div class="mx-auto max-w-screen-xl px-4 2xl:px-0">
    <div class="grid gap-2 grid-cols-12">
      <div class="col-span-full md:col-span-8">
        @if (!pageLoading) {
        <p-table
          [value]="bag!.items"
          styleClass="p-datatable-gridlines"
          size="small"
          selectionMode="single"
          [(selection)]="selectedProduct"
          dataKey="id"
          #dt
          [rowHover]="true"
        >
          <ng-template #caption>
            <div class="flex flex-wrap h-10">
              <h2
                class="text-xl flex-grow font-semibold text-gray-900 dark:text-white sm:text-2xl"
              >
                {{ bag?.name }}
              </h2>

              @if (selectedProduct) {
              <p-button
                label="{{ isMobile ? '' : 'Edit' }}"
                severity="contrast"
                rounded="{{ isMobile ? 'circle' : '' }}"
                text
                icon="pi pi-pencil"
                size="small"
              />

              <p-button
                label="{{ isMobile ? '' : 'Remove' }}"
                severity="danger"
                rounded="{{ isMobile ? 'circle' : '' }}"
                text
                icon="pi pi-trash"
                size="small"
                (onClick)="onRemoveItem(selectedProduct)"
              />
              }
            </div>
          </ng-template>
          <ng-template #header>
            <tr>
              <th style="width: 3rem"></th>
              <th>Name</th>
              <th>Qty</th>
              <th>Price(LKR)</th>
            </tr>
          </ng-template>
          <ng-template #body let-item>
            <tr [pSelectableRow]="item">
              <td>
                <p-tableRadioButton [value]="item"></p-tableRadioButton>
              </td>
              <td>{{ item.name }}</td>
              <td>{{ item.buyingQuantity }}{{ item.measurementType }}</td>
              <td>
                {{ getItemPrice(item) }}

                @if(item.discountPercentage){
                <span class="line-through text-red-500 font-medium">{{
                  getItemPrice(item, false)
                }}</span>
                }
              </td>
            </tr>
          </ng-template>
          <ng-template #footer>
            <tr>
              <td colspan="3" class="text-right p-3 pb-0">Sub Total</td>

              <td class="p-3 pb-0">
                {{ getSubTotal(bag!) }}
              </td>
            </tr>
            <tr>
              <td colspan="3" class="p-3 pb-0">
                <span class="text-right text-green-600">Savings</span>
              </td>

              <td class="p-3 pb-0">-{{ getTotalSavings(bag!) }}</td>
            </tr>
            <tr>
              <td colspan="3" class="text-right p-3 pb-0">Service Fee</td>

              <td class="p-3 pb-0">
                {{ getServiceFee(bag!) }}
              </td>
            </tr>
            <tr>
              <td colspan="3" class="text-right font-medium p-3 pb-0">
                Net Total
              </td>

              <td class="font-bold p-3 pb-0">
                {{ getNetTotal(bag!) }}
              </td>
            </tr>
          </ng-template>
        </p-table>
        }@else {
        <p-skeleton styleClass="mb-2" height="500px" />
        }
      </div>
      <div class="col-span-full md:col-span-4">
        @if (!pageLoading) {
        <div class="col-span-4 bg-blue-400 h-10"></div>
        } @else {
        <p-skeleton styleClass="mb-2" height="300px" />
        }
      </div>
    </div>
  </div>
</section>
